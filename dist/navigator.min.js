"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){"function"==typeof define&&define.amd?define(["zepto"],t):t(Zepto)}(function(t){var n=function n(i,e){this.options=t.extend({},n.defaults,e),this.$element=t(i),this.init(),t("body").css("padding-top",this.$element.height())};n.pluginName="H5Navigator",n.dataName="H5NavigatorData",n.version="1.0.0",n.defaults={openDebug:!0,title:"",titleAlign:"center",backgroundColor:"#e83031",autoHideNavArea:"",showRightNav:!1,rightNavIcon:"",clickLeftNavCallback:null,clickRightNavCallback:null,isExitWhenNoPageBack:!1,iosScrollBottomCallback:null},n.prototype={init:function(){var n=this;if(this.debug("==== 导航栏插件开始初始化 ===="),this.$element.data("platform",this.isIos()?1:0),this.$element.html('\n        <div class="nav-bg"></div>\n        <div class="nav">\n          <div class="back"><i class="iconfont icon-back"></i></div>\n          <div class="title '+this.options.titleAlign+'"><p class="inner"><span class="text">'+this.options.title+"</span></p></div>\n          "+(this.options.showRightNav?'<div class="other"><i class="iconfont icon-'+this.options.rightNavIcon+'"></i></div>':"")+"\n        </div>\n      "),this.$element.find(".nav-bg").css("background-color",this.options.backgroundColor),this.scrollTitle(),this.$element.find(".back").on("click",function(){n.debug("触发了导航最左边图标的点击事件"),n.options.clickLeftNavCallback&&"function"==typeof n.options.clickLeftNavCallback?n.options.clickLeftNavCallback.apply(n):(n.debug("执行了history.back"),n.options.isExitWhenNoPageBack&&1===history.length&&"function"==typeof callNativeHandler?callNativeHandler("goback",{type:"component"},function(t){}):history.back())}),this.options.showRightNav&&this.$element.find(".other").on("click",function(){n.debug("触发了导航最右边图标的点击事件"),n.options.clickRightNavCallback&&"function"==typeof n.options.clickRightNavCallback&&n.options.clickRightNavCallback.apply(n)}),this.isIos()){var i=document.createElement("script");i.language="JavaScript",i.type="text/javascript",i.src="http://s.thsi.cn/js/m/kh/common/scripts/iscroll-probe.js",document.body.appendChild(i),i.onload=function(i){n.debug("==== 加载iscroll.js成功 ===="),t("html, body").css({height:"100%",overflow:"hidden"}),t(".container").css({height:t("body").height()-n.$element.height()});var e=new IScroll(".container",{mouseWheel:!0,scrollbars:!1,probeType:n.options.autoHideNavArea?3:1,click:!0,tap:!0});window.myIscroll=e,n.options.autoHideNavArea&&(n.changeOpacity(),e.on("scroll",function(){n.changeOpacity()}),e.on("scrollEnd",function(){n.changeOpacity()})),n.options.iosScrollBottomCallback&&(n.hasScrollToBottom=!1,e.on("scrollEnd",function(){Math.abs(e.y-e.maxScrollY)<20&&1===e.directionY&&!n.hasScrollToBottom&&"function"==typeof n.options.iosScrollBottomCallback&&(n.options.iosScrollBottomCallback(),n.hasScrollToBottom=!0)}));var o=0;n.$element.find(".text").on("touchstart",function(){var t=(new Date).getTime();t-o<400?(n.debug("触发了导航双击事件"),e.scrollTo(0,0,300),n.options.autoHideNavArea&&setTimeout(function(){n.changeOpacity()},300)):o=t})},i.onerror=function(){n.debug("加载iscroll.js失败")}}else{var e=0;this.$element.on("click",function(i){if(i.target.className.indexOf("text")>-1){var o=(new Date).getTime();o-e<400?(n.debug("触发了导航双击事件"),e=0,n.scrollToTop({element:t(window),toT:0,durTime:300,delay:30,callback:null})):e=o}}),this.options.autoHideNavArea&&(this.changeOpacity(),t(window).on("scroll",function(){n.changeOpacity()}))}},debug:function(){this.options.openDebug&&console.log.apply(this,arguments)},scrollToTop:function(n){var i={element:t(window),toT:0,durTime:500,delay:30,callback:null},e=t.extend(i,n),o=null,a=e.element,l=a.scrollTop(),c=e.toT-l,s=0,r=Math.round(e.durTime/e.delay),f=function(t){s++;var n=Math.round(c/r);if(s>=r)return window.scrollTo(0,t),window.clearInterval(o),void(e.callback&&"function"==typeof e.callback&&e.callback());window.scrollTo(0,l+s*n)};o=window.setInterval(function(){f(e.toT)},e.delay)},scrollTitle:function(){var t=this,n=this.$element.find(".title").width();if(this.$element.find(".title .inner .text").width()>n){var i=this.$element.find(".title .inner");i.append(i.html());var e=this.$element.find(".title .inner .text"),o=e.eq(0).width(),a=0;setTimeout(function(){t.titleTimer=setInterval(function(){a+=1,e.css("left",-a),a>o&&(a=0)},60)},3e3)}},changeOpacity:function(){var n=this.options.autoHideNavArea.split(",").filter(function(n){return t(n).length>0}),i=this.$element.height(),e=this.isIos();if(e&&window.myIscroll.y>0)return!1;var o=e?Math.abs(window.myIscroll.y):t(window).scrollTop(),a=null;if(n.some(function(n){var e=t(n);if(e&&e.offset()){return!!(0===o&&e.offset().top===i||e.offset().top-o<=0&&e.offset().top+e.offset().height>o)&&(a=e,!0)}return!1}))if(0===o)t("body").css("padding-top","0 !important"),t(".container").css({height:t("body").height()}),this.$element.find(".nav-bg").css("opacity",0),window.myIscroll.refresh();else{var l=(a.offset().top+a.offset().height+80-i-o)/a.offset().height;l=l.toFixed(2),l>1&&(l=1),l<0&&(l=0),this.$element.find(".nav-bg").css("opacity",1-l)}else 1!==this.$element.find(".nav-bg").css("opacity")&&this.$element.find(".nav-bg").css("opacity",1)},isIos:function(){return navigator.userAgent.indexOf("iPhone")>-1||navigator.userAgent.indexOf("iPad")>-1||navigator.userAgent.indexOf("Mac")>-1}};var i=t.fn[n.pluginName];t.fn[n.pluginName]=function(i){return this.each(function(){var e=t(this),o=t.fn[n.pluginName].pluginData[e.data(n.dataName)],a="object"==(void 0===i?"undefined":_typeof(i))&&i;o||(t.fn[n.pluginName].pluginData[++t.fn[n.pluginName].pluginData.index]=new n(this,a),e.data(n.dataName,t.fn[n.pluginName].pluginData.index),o=t.fn[n.pluginName].pluginData[e.data(n.dataName)]),"string"==typeof i&&o[i]()})},t.fn[n.pluginName].pluginData={index:0},t.fn[n.pluginName].Constructor=n,t.fn[n.pluginName].noConflict=function(){return t.fn[n.pluginName]=i,this},t.fn[n.pluginName].init=function(i){t('<div data-role="'+n.pluginName+'">').addClass("navigator").appendTo("body"),t.fn[n.pluginName].call(t('div[data-role="'+n.pluginName+'"]'),i)},t.fn[n.pluginName].changeOptions=function(i){var e=t('[data-role="'+n.pluginName+'"]');if(e.length>0){for(var o in i)!function(t){switch(t){case"title":e.find(".title .inner .text").html(i[t]);break;case"clickLeftNavCallback":"function"==typeof i[t]&&e.find(".nav .back").off("click").on("click",function(){i[t]()})}}(o)}}});