"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){"function"==typeof define&&define.amd?define(["zepto"],t):t(Zepto)}(function(t){var n=function n(i,e){this.options=t.extend({},n.defaults,e),this.$element=t(i),this.init()};n.pluginName="H5Navigator",n.dataName="H5NavigatorData",n.version="1.0.0",n.defaults={openDebug:!0,title:"",titleAlign:"center",backgroundColor:"#e83031",autoHideNavArea:"",showRightNav:!1,rightNavIcon:"",clickLeftNavCallback:null,clickRightNavCallback:null,isExitWhenNoPageBack:!1},n.prototype={init:function(){var n=this;this.debug("==== 导航栏插件开始初始化 ===="),this.$element.html('\n        <div class="nav-bg"></div>\n        <div class="nav">\n          <div class="back"><i class="iconfont icon-back"></i></div>\n          <div class="title '+this.options.titleAlign+'"><p class="inner"><span class="text">'+this.options.title+"</span></p></div>\n          "+(this.options.showRightNav?'<div class="other"><i class="iconfont icon-'+this.options.rightNavIcon+'"></i></div>':"")+"\n        </div>\n      "),this.$element.find(".nav-bg").css("background-color",this.options.backgroundColor),this.scrollTitle();var i=0;if(this.$element.on("click",function(e){if(e.target.className.indexOf("text")>-1){var o=(new Date).getTime();o-i<400?(n.debug("触发了导航双击事件"),i=0,n.scrollToTop({element:t(window),toT:0,durTime:300,delay:30,callback:null})):i=o}}),this.$element.find(".back").on("click",function(){n.debug("触发了导航最左边图标的点击事件"),n.options.clickLeftNavCallback&&"function"==typeof n.options.clickLeftNavCallback?n.options.clickLeftNavCallback.apply(n):(n.debug("执行了history.back"),n.debug(history.length,callNativeHandler),n.options.isExitWhenNoPageBack&&1===history.length&&"function"==typeof callNativeHandler?callNativeHandler("goback",{type:"component"},function(t){}):history.back())}),this.options.showRightNav&&this.$element.find(".other").on("click",function(){n.debug("触发了导航最右边图标的点击事件"),n.options.clickRightNavCallback&&"function"==typeof n.options.clickRightNavCallback&&n.options.clickRightNavCallback.apply(n)}),this.options.autoHideNavArea&&(this.changeOpacity(),this.isIos()||t(window).on("scroll",function(){n.changeOpacity()})),this.isIos()){var e=document.createElement("script");e.language="JavaScript",e.type="text/javascript",e.src="http://s.thsi.cn/js/m/kh/common/scripts/iscroll-probe.js",document.body.appendChild(e),e.onload=function(i){n.debug("==== 加载iscroll.js成功 ===="),t("html, body").css({height:"100%",overflow:"hidden"}),t(".container").css("height","100%");var e=new IScroll(".container",{mouseWheel:!0,scrollbars:!1,probeType:2});e.on("scroll",function(){n.changeOpacity()}),e.on("scrollStart",function(){n.changeOpacity()}),e.on("scrollEnd",function(){n.changeOpacity()})},e.onerror=function(t){n.debug("加载iscroll.js失败")}}},debug:function(){this.options.openDebug&&console.log.apply(this,arguments)},scrollToTop:function(n){var i={element:t(window),toT:0,durTime:500,delay:30,callback:null},e=t.extend(i,n),o=null,a=e.element,l=a.scrollTop(),c=e.toT-l,s=0,r=Math.round(e.durTime/e.delay),f=function(t){s++;var n=Math.round(c/r);if(s>=r)return document.documentElement.scrollTop=t,window.clearInterval(o),void(e.callback&&"function"==typeof e.callback&&e.callback());document.documentElement.scrollTop=l+s*n};o=window.setInterval(function(){f(e.toT)},e.delay)},scrollTitle:function(){var t=this,n=this.$element.find(".title").width();if(this.$element.find(".title .inner .text").width()>n){var i=this.$element.find(".title .inner");i.append(i.html());var e=this.$element.find(".title .inner .text"),o=e.eq(0).width(),a=0;setTimeout(function(){t.titleTimer=setInterval(function(){a+=1,e.css("left",-a),a>o&&(a=0)},60)},3e3)}},changeOpacity:function(){var n=this.options.autoHideNavArea.split(",").filter(function(n){return t(n).length>0}),i=this.$element.height(),e=t(window).scrollTop(),o=null;if(n.some(function(n){var i=t(n);return!(!i||!i.offset())&&(i.offset().top-e<=0&&i.offset().top+i.offset().height>e&&(o=i,!0))})){t("body").css("padding-top","0");var a=(o.offset().top+o.offset().height+80-i-e)/o.offset().height;a=a.toFixed(2),a>1&&(a=1),a<0&&(a=0),this.$element.find(".nav-bg").css("opacity",1-a)}else 1!==this.$element.find(".nav-bg").css("opacity")&&this.$element.find(".nav-bg").css("opacity",1)},isIos:function(){return navigator.userAgent.indexOf("iPhone")>-1||navigator.userAgent.indexOf("iPad")>-1||navigator.userAgent.indexOf("Mac")>-1}};var i=t.fn[n.pluginName];t.fn[n.pluginName]=function(i){return this.each(function(){var e=t(this),o=t.fn[n.pluginName].pluginData[e.data(n.dataName)],a="object"==(void 0===i?"undefined":_typeof(i))&&i;o||(t.fn[n.pluginName].pluginData[++t.fn[n.pluginName].pluginData.index]=new n(this,a),e.data(n.dataName,t.fn[n.pluginName].pluginData.index),o=t.fn[n.pluginName].pluginData[e.data(n.dataName)]),"string"==typeof i&&o[i]()})},t.fn[n.pluginName].pluginData={index:0},t.fn[n.pluginName].Constructor=n,t.fn[n.pluginName].noConflict=function(){return t.fn[n.pluginName]=i,this},t.fn[n.pluginName].init=function(i){t('<div data-role="'+n.pluginName+'">').addClass("navigator").appendTo("body"),t.fn[n.pluginName].call(t('div[data-role="'+n.pluginName+'"]'),i)},t.fn[n.pluginName].changeOptions=function(i){var e=t('[data-role="'+n.pluginName+'"]');if(e.length>0){for(var o in i)!function(t){switch(t){case"title":e.find(".title .inner .text").html(i[t]);break;case"clickLeftNavCallback":"function"==typeof i[t]&&e.find(".nav .back").off("click").on("click",function(){i[t]()})}}(o)}}});